SELECT * FROM [dbo].[Covid_Deaths]
SELECT * FROM [dbo].[Covid_Vaccination]

-- FINDING TOTAL CASES AND TOTAL DEATH BY LOCATION
SELECT [continent],[location], SUM(CAST([new_cases] AS NUMERIC)) TOTAL_CASES,SUM([new_deaths]) TOTAL_DEATH
FROM [dbo].[Covid_Deaths]
GROUP BY [continent],[location]
ORDER BY 3 DESC




--FIND TOTAL DEATH AND TOTAL CASES BY CONTINENT
SELECT [continent], SUM(CAST([new_cases] AS NUMERIC)) TOTAL_CASES, SUM([new_deaths]) TOTAL_DEATH
FROM [dbo].[Covid_Deaths]
GROUP BY [continent]
ORDER BY 2 DESC




--MAX CASE IN A DAY (WITH DATE) PER LOCATION WISE
WITH CTD AS
(
SELECT [location], MAX([new_cases]) MAX_CASE
FROM [dbo].[Covid_Deaths]
GROUP BY [location]
--ORDER BY 2 DESC
)
SELECT B.[location], B.MAX_CASE, A.[Date]
FROM [dbo].[Covid_Deaths] A JOIN CTD B
ON A.[location] = B.[location]
AND A.[new_cases] = B.MAX_CASE
ORDER BY 2 DESC






--MAX DEATH IN A DAY (WITH DATE) PER LOCATION WISE
WITH CTD AS
(
SELECT [location], MAX([new_deaths]) MAX_DEATH
FROM [dbo].[Covid_Deaths]
GROUP BY [location]
--ORDER BY 2 DESC
)
SELECT B.[location], B.MAX_DEATH, A.[Date]
FROM [dbo].[Covid_Deaths] A JOIN CTD B
ON A.[location] = B.[location]
AND A.[new_deaths] = B.MAX_DEATH
ORDER BY 2 DESC




--COMPARING MAX CASE IN A DAY WITH TOTAL CASES IN PERCENTAGE
WITH CT1 AS
(
SELECT [continent],[location], SUM(CAST([new_cases] AS NUMERIC)) TOTAL_CASES, SUM([new_deaths]) TOTAL_DEATH
FROM [dbo].[Covid_Deaths]
GROUP BY [continent],[location]
--ORDER BY 1,3 DESC
),
CT2 AS
(
SELECT [location], MAX([new_cases]) MAX_CASE
FROM [dbo].[Covid_Deaths]
GROUP BY [location]
--ORDER BY 2 DESC
)
SELECT A.[location], A.TOTAL_CASES, B.MAX_CASE, ROUND((B.MAX_CASE/A.TOTAL_CASES)*100,2) 'Max_Case (%)'
FROM CT1 A JOIN CT2 B
ON A.[location] = B.[location]
WHERE A.TOTAL_CASES <> 0
AND A.TOTAL_DEATH <> 0
AND B.MAX_CASE <> 0
ORDER BY 2 DESC




-- COMPARING TOTAL CASES WITH TOTAL DEATH IN PERCENTAGE LOCATION WISE.
WITH CT1 AS
(
SELECT [continent],[location], SUM(CAST([new_cases] AS NUMERIC)) TOTAL_CASES,SUM([new_deaths]) TOTAL_DEATH
FROM [dbo].[Covid_Deaths]
GROUP BY [continent],[location]
--ORDER BY 1,3 DESC
)
SELECT [location], TOTAL_CASES, TOTAL_DEATH, ROUND((TOTAL_DEATH/TOTAL_CASES)*100,2) PERCENTAGE
FROM CT1
WHERE TOTAL_CASES <> 0
AND TOTAL_DEATH <> 0
ORDER BY 3 DESC




--AVERAGE TESTS TAKEN PER DAY IN APRIL 2020 VS APRIL 2021 WITH INCREMENT IN PERCENTAGE
WITH CT1 AS
(
SELECT [location],AVG([new_tests]) AVG_TEST
FROM [project].[dbo].[Covid_Vaccination]
WHERE ([date] BETWEEN '20-04-01' AND '20-04-30')
AND [location] = 'INDIA'
GROUP BY [location]
),
CT2 AS
(
SELECT [location],AVG([new_tests]) AVG_TEST
FROM [project].[dbo].[Covid_Vaccination]
WHERE ([date] BETWEEN '21-04-01' AND '21-04-30')
AND [location] = 'INDIA'
GROUP BY [location]
)
SELECT A1.[location],A1.AVG_TEST APRIL_20, A2.AVG_TEST APRIL_21,
--ROUND(CAST(A1.AVG_TEST AS DECIMAL)/CAST(A2.AVG_TEST AS DECIMAL)*100,2) 'DIFFERENCE(%)',
ROUND((CAST(A2.AVG_TEST AS DECIMAL) - CAST(A1.AVG_TEST AS DECIMAL))/CAST(A2.AVG_TEST AS DECIMAL)*100,2) 'DIFFERENCE(%)'
FROM CT1 A1 JOIN CT2 A2
ON A1.[location] = A2.[location]





--HOW MANY PERCENTAGE OF PEOPLE GOT FULLY VACCINATED IN INDIA FROM JAN 2020 TO APRIL 2021
WITH CT1 AS
(
SELECT [location],[date],[2ND_DOSE_CMPT],
ABS([2ND_DOSE_CMPT]-LAG([2ND_DOSE_CMPT]) OVER(ORDER BY [date])) 'FULYY_VACCINATED'
FROM [project].[dbo].[Covid_Vaccination]
WHERE [location] = 'INDIA'
AND [2ND_DOSE_CMPT] <> 0
),
CT2 AS
(
SELECT A1.[location], SUM(A1.FULYY_VACCINATED) 'JAN20_APR21', AVG(CAST(A2.[population] AS NUMERIC)) 'INDIA_POPULATION'
FROM CT1 A1 JOIN project.[dbo].[Covid_Vaccination] A2
ON A1.[location] = A2.[location] AND A1.[date] = A2.[date]
GROUP BY A1.[location]
)
SELECT [location], JAN20_APR21, INDIA_POPULATION, ROUND(JAN20_APR21/INDIA_POPULATION*100,2) 'FULLY_VACC(%)'
FROM CT2





-- COMPARISION BETWEEN TOTAL_DOSES_CMPT & TOTAL_TEST_DONE LOCATION WISE
WITH CT1 AS (
SELECT [location],SUM([new_tests]) TEST_COMPLETED ,SUM([DOSE_PER_DAY]) DOSES_COMPELETED, SUM(CAST([new_tests] AS DECIMAL))/SUM(CAST([DOSE_PER_DAY] AS DECIMAL))*100 'TEST_VS_DOSE'
FROM [dbo].[Covid_Vaccination]
WHERE [DOSE_PER_DAY] <> 0
AND [new_tests] <> 0
GROUP BY [location]
--ORDER BY 2 DESC
)
SELECT [location], TEST_COMPLETED, DOSES_COMPELETED, ROUND(TEST_VS_DOSE,2),CASE
WHEN (DOSES_COMPELETED > TEST_COMPLETED) THEN 'DOSES ARE GREATER THEN TEST DONE'
WHEN (DOSES_COMPELETED < TEST_COMPLETED) THEN 'DOSES ARE LESSER THEN TEST DONE'
END REMARK
FROM CT1
ORDER BY 2 DESC





-- COMPARISON BETWEEN 1ST DOES PER DAY & 2ND DOSE PER DAY IN PERCENTAGE
WITH CT1D AS (
--1ST DOSE INJECTED PER DAY
SELECT [location],[date],[1ST_DOSE_CMPT], 
[1ST_DOSE_CMPT]-LAG([1ST_DOSE_CMPT]) OVER(PARTITION BY [location] ORDER BY [date]) '1ST_DOSE_PER_DAY'
FROM [dbo].[Covid_Vaccination]
WHERE [location] = 'INDIA'
--AND [1ST_DOSE_CMPT] <> 0
--ORDER BY [date]
),
CT2D AS (
-- 2ND DOSE INJECTED PER DAY
SELECT [location],[date],[2ND_DOSE_CMPT], 
[2ND_DOSE_CMPT]-LAG([2ND_DOSE_CMPT]) OVER(PARTITION BY [location] ORDER BY [date]) '2ND_DOSE_PER_DAY'
FROM [dbo].[Covid_Vaccination]
WHERE [location] = 'INDIA'
--AND [2ND_DOSE_CMPT] <> 0
--ORDER BY [date]
),
CT3D AS (
SELECT A.[location], A.[date], A.[1ST_DOSE_PER_DAY] '1ST_DOSE_PER_DAY',B.[2ND_DOSE_PER_DAY] '2ND_DOSE_PER_DAY',
A.[1ST_DOSE_PER_DAY]+B.[2ND_DOSE_PER_DAY] TOTAL_DOSE_PER_DAY
FROM CT1D A JOIN CT2D B
ON A.[date] = B.[date]
)
SELECT ABS(C.[1ST_DOSE_PER_DAY]) '1ST_DOSE', ABS(C.[2ND_DOSE_PER_DAY]) '2ND_DOSE', ABS(C.TOTAL_DOSE_PER_DAY) 'DOSES_PER_DAY',  
ROUND(ABS(NULLIF(CAST(C.[1ST_DOSE_PER_DAY] AS DECIMAL),0)/CAST(C.TOTAL_DOSE_PER_DAY AS DECIMAL) *100),2) '1ST_DOSE_PER_DAY (%)'
FROM CT3D C
WHERE C.[1ST_DOSE_PER_DAY] <> 0




--COMPARISION BETWEEN TOTAL_CASES , TOTAL DEATHS & TOTAL_DOSES_PER_DAY	IN INDIA FROM JAN 2020 TO APR 2021
WITH CT1 AS
(
SELECT [location],[population], SUM([new_cases]) TOTAL_CASES ,SUM([new_deaths]) TOTAL_DEATH
FROM [dbo].[Covid_Deaths]
WHERE [location] = 'INDIA'
GROUP BY [location],[population]
),
CT2 AS 
(
SELECT [location],[DOSE_CMPT] TOTAL_DOSES
FROM [dbo].[Covid_Vaccination]
WHERE [location] = 'INDIA'
AND [date] = '21-04-30'
)
SELECT A1.[location] 'LOCATION',
A1.population 'POPULATION',A1.TOTAL_CASES,ROUND(A1.TOTAL_CASES/A1.population*100,2) 'TOTAL_CASES(%)', 
A1.TOTAL_DEATH, ROUND(A1.TOTAL_DEATH/A1.population*100,2) 'TOTAL_DEATH (%)',
A2.TOTAL_DOSES, ROUND(A2.TOTAL_DOSES/A1.population*100,2) 'TOTAL_DOSES (%)'
FROM CT1 A1 JOIN CT2 A2
ON A1.location = A2.location





-- TOTAL DOSE COMPLETED BY EACH LOCATION TILL APRIL 2021
SELECT [location],DATE,CAST([DOSE_CMPT]AS NUMERIC) DOSE_CMPT FROM [dbo].[Covid_Vaccination]
WHERE [DOSE_CMPT] <> 0
AND [date] = (SELECT  MAX([date])
FROM [dbo].[Covid_Vaccination])
GROUP BY [location],DATE,[DOSE_CMPT]
ORDER BY 3 DESC


